<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>台灣地圖遊戲介面 - MVP 原型</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --panel-bg: rgba(17, 24, 39, 0.7);   /* 深色半透明 */
      --panel-border: rgba(255,255,255,0.15);
      --text: #e5e7eb;                     /* 替代白文字 */
      --muted: #cbd5e1;                    /* 次要文字 */
      --accent: #38bdf8;                   /* 天藍重點 */
      --ok: #22c55e;                       /* 綠色 */
      --warn: #f59e0b;                     /* 橘色 */
      --danger: #ef4444;                   /* 紅色 */
      --blur: blur(6px);
    }

    html, body {
      height: 100%;
    }
    body{
      margin: 0;
      font-family: "Noto Sans TC", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      /* 背景：台灣地圖 */
      background: url('台灣地圖.jpg') center center / cover no-repeat fixed;
    }

    /* 套一個淡淡的暗色漸層讓地圖不搶字體 */
    body::before{
      content: "";
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at 20% 30%, rgba(0,0,0,0.25), transparent 50%),
                  radial-gradient(ellipse at 80% 70%, rgba(0,0,0,0.35), transparent 55%),
                  linear-gradient(to bottom, rgba(0,0,0,0.25), rgba(0,0,0,0.4));
      pointer-events: none;
    }

    .wrap{
      position: relative;
      min-height: 100vh;
      display: flex;
      gap: 16px;
      align-items: stretch;
      justify-content: space-between;
      padding: 16px;
      box-sizing: border-box;
    }

    .panel{
      width: 320px;
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: 16px;
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      padding: 16px;
    }

    .panel h2{
      margin: 0 0 10px;
      font-size: 18px;
      letter-spacing:.5px;
      font-weight: 700;
    }

    .panel .section{
      border-top: 1px dashed var(--panel-border);
      padding-top: 12px;
      margin-top: 12px;
    }

    .stat{
      display: grid;
      grid-template-columns: 110px 1fr auto;
      gap: 8px;
      align-items: center;
      padding: 8px 0;
    }

    .stat .label{ color: var(--muted); }
    .stat .value{ font-weight: 700; }

    .bar{
      position: relative;
      height: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.15);
    }
    .bar > span{
      display: block;
      height: 100%;
      width: 50%; /* 預設一半，實際可用 JS 調整 */
      background: linear-gradient(90deg, var(--accent), #60a5fa);
    }

    .list{ margin: 0; padding: 0; list-style: none; }
    .list li{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 8px;
      border: 1px solid var(--panel-border);
      border-radius: 12px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.03);
    }

    .badge{
      display: inline-block;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--panel-border);
      color: var(--muted);
    }

    .health{
      display: grid;
      grid-template-columns: 1fr 56px;
      gap: 10px;
      align-items: center;
      width: 100%;
    }
    .hpbar{ height: 8px; border-radius: 999px; overflow:hidden; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); }
    .hpbar > span{ display:block; height:100%; width:100%; background: linear-gradient(90deg, #34d399, #10b981); }
    .hptext{ font-size: 12px; color: var(--muted); text-align: right; }    /* 互動式地圖區 */
    .map-wrap{ position: relative; flex: 1 1 auto; min-height: 0; }
    .map-viewport{
      position: absolute; inset: 0; overflow: hidden; border-radius: 16px;
      border: 1px solid var(--panel-border);
      background: rgba(0,0,0,0.15);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
    }
    .map-inner{ width: 100%; height: 100%; touch-action: none; cursor: grab; }
    .map-inner.dragging{ cursor: grabbing; }
    .map-img{ user-select: none; -webkit-user-drag: none; pointer-events: none; transform-origin: 0 0; will-change: transform; }

    .map-controls{ position: absolute; right: 12px; bottom: 12px; display: grid; gap: 8px; }
    .map-controls button{
      background: var(--panel-bg); color: var(--text); border: 1px solid var(--panel-border);
      border-radius: 12px; padding: 8px 10px; font-weight: 700; min-width: 44px;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
    }

    /* RWD：手機直向時，上下堆疊 */
    @media (max-width: 900px){
      .wrap{ flex-direction: column; }
      .panel{ width: 100%; }
      .map-wrap{ height: 56vh; }
    }
  </style>
</head>
  </style>
</head>
<body>
  <div class="wrap">
    <!-- 左側資訊欄 -->
    <aside class="panel" aria-label="資源與狀態面板">
      <h2>資訊欄</h2>
      <div class="stat">
        <div class="label">人數</div>
        <div class="bar" aria-label="人數進度"><span style="width: 80%"></span></div>
        <div class="value" id="stat-people">8/10</div>
      </div>
      <div class="stat">
        <div class="label">糧食</div>
        <div class="bar" aria-label="糧食存量"><span style="width: 45%"></span></div>
        <div class="value" id="stat-food">45%</div>
      </div>
      <div class="stat">
        <div class="label">精神</div>
        <div class="bar" aria-label="士氣精神"><span style="width: 62%"></span></div>
        <div class="value" id="stat-mind">62%</div>
      </div>

      <div class="section">
        <div class="badge">提示</div>
        <p style="margin:.6rem 0 0;color:var(--muted);line-height:1.6">此區顯示隊伍整體狀態。之後可用 JavaScript 即時更新數據。</p>
      </div>
    </aside>

    <!-- 互動式地圖區 -->
    <div class="map-wrap" aria-label="可縮放平移的台灣地圖">
      <div class="map-viewport">
        <div class="map-inner" id="mapInner">
          <img class="map-img" id="mapImg" src="台灣地圖.jpg" alt="台灣地圖" />
        </div>
        <div class="map-controls">
          <button id="zoomIn" aria-label="放大">＋</button>
          <button id="zoomOut" aria-label="縮小">－</button>
          <button id="reset" aria-label="重置">重置</button>
        </div>
      </div>
    </div>

    <!-- 右側功能欄 -->
    <aside class="panel" aria-label="操作與資訊面板">
      <h2>操作面板</h2>

      <section class="section">
        <h3 style="margin:0 0 8px;font-size:16px;font-weight:600">指派地點</h3>
        <ul class="list" id="task-list">
          <li>
            <span>台北｜士林補給</span>
            <span class="badge">距離 3.2 km</span>
          </li>
          <li>
            <span>新北｜新店巡察</span>
            <span class="badge">距離 6.5 km</span>
          </li>
        </ul>
      </section>

      <section class="section">
        <h3 style="margin:0 0 8px;font-size:16px;font-weight:600">背包</h3>
        <ul class="list" id="bag-list">
          <li><span>罐頭 × 5</span><span class="badge">重量 2.5kg</span></li>
          <li><span>繃帶 × 3</span><span class="badge">醫療</span></li>
          <li><span>手電筒 × 1</span><span class="badge">耐久 80%</span></li>
        </ul>
      </section>

      <section class="section">
        <h3 style="margin:0 0 8px;font-size:16px;font-weight:600">隊友資訊</h3>
        <ul class="list" id="ally-list">
          <li>
            <strong>阿凱</strong>
            <div class="health">
              <div class="hpbar"><span style="width: 78%"></span></div>
              <div class="hptext">78/100</div>
            </div>
          </li>
          <li>
            <strong>小芸</strong>
            <div class="health">
              <div class="hpbar"><span style="width: 52%"></span></div>
              <div class="hptext">52/100</div>
            </div>
          </li>
          <li>
            <strong>阿宏</strong>
            <div class="health">
              <div class="hpbar"><span style="width: 96%"></span></div>
              <div class="hptext">96/100</div>
            </div>
          </li>
        </ul>
      </section>
    </aside>
  </div>

  <!-- 簡易腳本（未連資料，只示範結構，之後可掛事件或 WebSocket） -->
  <script>
    // 若未來需要動態更新，只要修改對應元素的文字或 style.width 即可：
    // document.getElementById('stat-food').textContent = '72%';
    // document.querySelectorAll('.hpbar > span')[0].style.width = '60%';
  </script>
  <!-- 簡易腳本（未連資料，只示範結構，之後可掛事件或 WebSocket） -->
  <script>
    // ====== 縮放與平移邏輯（零依賴、支援滑鼠與觸控）／加入邊界限制與置中 ======
    (function(){
      const inner = document.getElementById('mapInner');
      const img = document.getElementById('mapImg');
      const btnIn = document.getElementById('zoomIn');
      const btnOut = document.getElementById('zoomOut');
      const btnReset = document.getElementById('reset');

      // 狀態
      let scale = 1, minScale = 1, maxScale = 5;
      let tx = 0, ty = 0; // 平移量
      let dragging = false, lastX = 0, lastY = 0;

      // 觸控縮放
      let touching = false, lastDist = 0, center = {x:0, y:0};

      function viewportRect(){ return inner.getBoundingClientRect(); }
      function natural(){
        return { w: img.naturalWidth || 2000, h: img.naturalHeight || 3000 };
      }

      // 根據容器大小，設定最小縮放＝不露白（cover）
      function recomputeMinScale(){
        const rect = viewportRect();
        const n = natural();
        const sW = rect.width / n.w;
        const sH = rect.height / n.h;
        minScale = Math.max(sW, sH); // 以 cover 為下限
        if (scale < minScale) scale = minScale;
      }

      // 讓圖片保持在容器邊界內；若圖小於容器就置中並鎖住拖曳
      function clampToBounds(){
        const rect = viewportRect();
        const n = natural();
        const w = n.w * scale;
        const h = n.h * scale;

        if (w <= rect.width){
          tx = (rect.width - w) / 2; // 置中並忽略左右拖曳
        } else {
          const minTx = rect.width - w;
          const maxTx = 0;
          if (tx < minTx) tx = minTx;
          if (tx > maxTx) tx = maxTx;
        }

        if (h <= rect.height){
          ty = (rect.height - h) / 2; // 置中並忽略上下拖曳
        } else {
          const minTy = rect.height - h;
          const maxTy = 0;
          if (ty < minTy) ty = minTy;
          if (ty > maxTy) ty = maxTy;
        }
      }

      function apply(){
        clampToBounds();
        img.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
      }

      function fitToViewport(){
        recomputeMinScale();
        const rect = viewportRect();
        const n = natural();
        const displayW = n.w * scale;
        const displayH = n.h * scale;
        tx = (rect.width - displayW) / 2;
        ty = (rect.height - displayH) / 2;
        apply();
      }

      function zoomAt(factor, cx, cy){
        const rect = viewportRect();
        // 容器內座標
        const x = cx == null ? rect.width / 2 : cx;
        const y = cy == null ? rect.height / 2 : cy;
        const prev = scale;
        scale = Math.max(minScale, Math.min(maxScale, scale * factor));
        const k = scale / prev;
        // 以（x, y）為中心縮放，調整平移量
        tx = x - k * (x - tx);
        ty = y - k * (y - ty);
        apply();
      }

      // 滑鼠拖曳（若小於容器會被 clamp 成置中）
      inner.addEventListener('mousedown', (e)=>{
        dragging = true; lastX = e.clientX; lastY = e.clientY; inner.classList.add('dragging');
      });
      window.addEventListener('mouseup', ()=>{ dragging = false; inner.classList.remove('dragging'); });
      window.addEventListener('mousemove', (e)=>{
        if(!dragging) return;
        const dx = e.clientX - lastX; const dy = e.clientY - lastY;
        lastX = e.clientX; lastY = e.clientY;
        tx += dx; ty += dy; apply();
      });

      // 滾輪縮放（限制不小於 cover）
      inner.addEventListener('wheel', (e)=>{
        e.preventDefault();
        const rect = viewportRect();
        const cx = e.clientX - rect.left;
        const cy = e.clientY - rect.top;
        const factor = (e.deltaY < 0) ? 1.1 : 0.9;
        zoomAt(factor, cx, cy);
      }, { passive: false });

      // 觸控：雙指縮放與單指拖曳
      inner.addEventListener('touchstart', (e)=>{
        if(e.touches.length === 1){
          dragging = true; lastX = e.touches[0].clientX; lastY = e.touches[0].clientY;
        } else if(e.touches.length === 2){
          touching = true; dragging = false;
          const [t1, t2] = e.touches;
          lastDist = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
          const rect = viewportRect();
          center.x = ((t1.clientX + t2.clientX)/2) - rect.left;
          center.y = ((t1.clientY + t2.clientY)/2) - rect.top;
        }
      }, { passive: false });

      inner.addEventListener('touchmove', (e)=>{
        e.preventDefault();
        if(touching && e.touches.length === 2){
          const [t1, t2] = e.touches;
          const dist = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
          const factor = dist / lastDist;
          lastDist = dist;
          zoomAt(factor, center.x, center.y);
        } else if(dragging && e.touches.length === 1){
          const x = e.touches[0].clientX, y = e.touches[0].clientY;
          const dx = x - lastX, dy = y - lastY;
          lastX = x; lastY = y; tx += dx; ty += dy; apply();
        }
      }, { passive: false });

      inner.addEventListener('touchend', ()=>{ touching = false; dragging = false; });

      // 控制按鈕
      btnIn.addEventListener('click', ()=> zoomAt(1.1));
      btnOut.addEventListener('click', ()=> zoomAt(0.9));
      btnReset.addEventListener('click', fitToViewport);

      // 禁止圖片原生拖曳
      img.addEventListener('dragstart', (e)=> e.preventDefault());

      // 初始縮放以不露白、置中
      if (img.complete) fitToViewport();
      else img.onload = fitToViewport;
      window.addEventListener('resize', ()=>{ recomputeMinScale(); apply(); });
    })();

    // ====== 之後可用以下方式更新狀態欄 ======
    // document.getElementById('stat-food').textContent = '72%';
    // document.querySelectorAll('.hpbar > span')[0].style.width = '60%';
  </script>
</body>
</html>
